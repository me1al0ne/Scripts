-- Mobile ESP & Camlock for Executors
-- Copy and paste this entire script into your executor

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- Local Player
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- Settings
local ESP_ENABLED = true
local SHOW_TEAMMATES = false -- Set to true to show teammates too
local MAX_DISTANCE = 1000
local REFRESH_RATE = 0.1

-- Camera Lock
local CAMERA_LOCK = false
local LOCKED_PLAYER = nil
local LOCKED_CHARACTER = nil
local LOCK_RANGE = 200
local SMOOTHNESS = 0.15

-- ESP Storage
local ESPData = {}
local ESPColor = Color3.fromRGB(255, 0, 0)
local ESPColorVisible = Color3.fromRGB(0, 255, 0)
local TeamColor = Color3.fromRGB(0, 100, 255)

-- UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ExecutorESP"
ScreenGui.Parent = game.CoreGui or LocalPlayer:WaitForChild("PlayerGui")

-- Lock Button
local LockButton = Instance.new("TextButton")
LockButton.Name = "CamLockBtn"
LockButton.Size = UDim2.new(0, 100, 0, 50)
LockButton.Position = UDim2.new(0.85, 0, 0.85, 0)
LockButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
LockButton.BackgroundTransparency = 0.3
LockButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LockButton.Text = "ðŸ”’ OFF"
LockButton.TextSize = 16
LockButton.BorderSizePixel = 0
LockButton.ZIndex = 100
LockButton.Font = Enum.Font.GothamBold
LockButton.Parent = ScreenGui

-- Make button draggable
local dragging = false
local dragStart, startPos

LockButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = LockButton.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        LockButton.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- Team check for executors (works with most games)
function isEnemy(player)
    if player == LocalPlayer then return false end
    
    -- Check if game uses Roblox teams
    local myTeam = LocalPlayer.Team
    local theirTeam = player.Team
    
    if myTeam and theirTeam then
        return myTeam ~= theirTeam
    end
    
    -- For games without teams, show everyone
    return true
end

-- Visibility check for executors
function isVisible(targetPos, targetChar)
    if not targetChar or not LocalPlayer.Character then return false end
    
    local params = RaycastParams.new()
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.FilterDescendantsInstances = {targetChar, LocalPlayer.Character}
    params.IgnoreWater = true
    
    local origin = Camera.CFrame.Position
    local direction = (targetPos - origin).Unit
    local distance = (targetPos - origin).Magnitude
    
    local result = Workspace:Raycast(origin, direction * distance, params)
    return result == nil
end

-- Create ESP for a player
function createESP(player)
    if ESPData[player] then return end
    
    -- Only create ESP for enemies (or everyone if SHOW_TEAMMATES is true)
    if not isEnemy(player) and not SHOW_TEAMMATES then
        return
    end
    
    ESPData[player] = {
        Box = nil,
        Label = nil,
        Tracer = nil,
        Highlight = nil,
        Character = nil
    }
    
    -- Create Highlight
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESP_Highlight"
    highlight.FillColor = Color3.fromRGB(255, 0, 0)
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.7
    highlight.OutlineTransparency = 0
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Enabled = false
    highlight.Parent = nil
    
    -- Create ESP Box
    local box = Instance.new("BillboardGui")
    box.Name = "ESP_Box"
    box.Size = UDim2.new(5, 0, 8, 0)
    box.AlwaysOnTop = true
    box.StudsOffset = Vector3.new(0, 3, 0)
    box.MaxDistance = MAX_DISTANCE
    box.Adornee = nil
    box.Enabled = false
    
    local boxFrame = Instance.new("Frame")
    boxFrame.Name = "BoxFrame"
    boxFrame.Size = UDim2.new(1, 0, 1, 0)
    boxFrame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    boxFrame.BackgroundTransparency = 0.7
    boxFrame.BorderSizePixel = 2
    boxFrame.BorderColor3 = Color3.fromRGB(255, 255, 255)
    boxFrame.Parent = box
    
    -- Create Info Label
    local label = Instance.new("BillboardGui")
    label.Name = "ESP_Label"
    label.Size = UDim2.new(0, 200, 0, 50)
    label.AlwaysOnTop = true
    label.StudsOffset = Vector3.new(0, 5, 0)
    label.MaxDistance = MAX_DISTANCE
    label.Adornee = nil
    label.Enabled = false
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Name = "Info"
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextStrokeTransparency = 0
    textLabel.TextSize = 14
    textLabel.Font = Enum.Font.GothamBold
    textLabel.Text = ""
    textLabel.TextYAlignment = Enum.TextYAlignment.Bottom
    textLabel.Parent = label
    
    -- Create Tracer
    local tracer = Instance.new("Frame")
    tracer.Name = "ESP_Tracer"
    tracer.Size = UDim2.new(0, 2, 0, 2)
    tracer.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    tracer.BorderSizePixel = 0
    tracer.Visible = false
    tracer.Parent = ScreenGui
    
    ESPData[player].Highlight = highlight
    ESPData[player].Box = box
    ESPData[player].Label = label
    ESPData[player].Tracer = tracer
    
    -- Track character
    if player.Character then
        ESPData[player].Character = player.Character
        attachESP(player, player.Character)
    end
    
    -- Character added
    player.CharacterAdded:Connect(function(char)
        ESPData[player].Character = char
        task.wait(0.5) -- Wait for character to load
        attachESP(player, char)
        
        if player == LOCKED_PLAYER then
            LOCKED_CHARACTER = char
        end
    end)
    
    -- Character removed
    player.CharacterRemoving:Connect(function()
        ESPData[player].Character = nil
        if ESPData[player].Highlight then
            ESPData[player].Highlight.Enabled = false
        end
        if ESPData[player].Box then
            ESPData[player].Box.Enabled = false
        end
        if ESPData[player].Label then
            ESPData[player].Label.Enabled = false
        end
        
        if player == LOCKED_PLAYER then
            CAMERA_LOCK = false
            LOCKED_PLAYER = nil
            LOCKED_CHARACTER = nil
            LockButton.Text = "ðŸ”’ OFF"
            LockButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
    end)
end

-- Attach ESP to character
function attachESP(player, char)
    if not char then return end
    
    local humanoid = char:WaitForChild("Humanoid", 2)
    local rootPart = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Head")
    
    if humanoid and rootPart and ESPData[player] then
        local data = ESPData[player]
        
        if data.Highlight then
            data.Highlight.Adornee = char
            data.Highlight.Parent = char
        end
        
        if data.Box then
            data.Box.Adornee = rootPart
            data.Box.Parent = rootPart
        end
        
        if data.Label then
            data.Label.Adornee = rootPart
            data.Label.Parent = rootPart
        end
    end
end

-- Clean up ESP
function removeESP(player)
    if ESPData[player] then
        local data = ESPData[player]
        
        if data.Highlight then
            data.Highlight:Destroy()
        end
        if data.Box then
            data.Box:Destroy()
        end
        if data.Label then
            data.Label:Destroy()
        end
        if data.Tracer then
            data.Tracer:Destroy()
        end
        
        ESPData[player] = nil
    end
end

-- Update ESP
function updateESP()
    for player, data in pairs(ESPData) do
        if player and data.Character and data.Character.Parent then
            local char = data.Character
            local humanoid = char:FindFirstChild("Humanoid")
            local rootPart = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Head")
            
            if humanoid and humanoid.Health > 0 and rootPart then
                local distance = (rootPart.Position - Camera.CFrame.Position).Magnitude
                
                if distance <= MAX_DISTANCE then
                    local visible = isVisible(rootPart.Position, char)
                    local isEnemyPlayer = isEnemy(player)
                    
                    -- Set colors
                    local color
                    if isEnemyPlayer then
                        color = visible and ESPColorVisible or ESPColor
                    else
                        color = TeamColor
                    end
                    
                    -- Update box
                    if data.Box and data.Box.Enabled then
                        data.Box.BoxFrame.BackgroundColor3 = color
                    end
                    
                    -- Update highlight
                    if data.Highlight then
                        data.Highlight.FillColor = color
                        data.Highlight.Enabled = true
                    end
                    
                    -- Update label
                    if data.Label then
                        local teamText = ""
                        if player.Team then
                            teamText = "[" .. player.Team.Name .. "] "
                        end
                        
                        local info = string.format("%s%s\n%.0f studs\nHP: %d/%d\n%s",
                            teamText,
                            player.Name,
                            distance,
                            math.floor(humanoid.Health),
                            math.floor(humanoid.MaxHealth),
                            visible and "VISIBLE" or "BEHIND WALL"
                        )
                        data.Label.Info.Text = info
                        data.Label.Info.TextColor3 = color
                        data.Label.Enabled = true
                    end
                    
                    -- Update box
                    if data.Box then
                        data.Box.Enabled = true
                    end
                    
                    -- Update tracer
                    if data.Tracer then
                        local screenPos, onScreen = Camera:WorldToViewportPoint(rootPart.Position)
                        if onScreen then
                            data.Tracer.Position = UDim2.new(0, screenPos.X, 0, screenPos.Y)
                            data.Tracer.BackgroundColor3 = color
                            data.Tracer.Visible = visible
                        else
                            data.Tracer.Visible = false
                        end
                    end
                else
                    -- Too far, hide ESP
                    if data.Highlight then data.Highlight.Enabled = false end
                    if data.Box then data.Box.Enabled = false end
                    if data.Label then data.Label.Enabled = false end
                    if data.Tracer then data.Tracer.Visible = false end
                end
            else
                -- Dead, hide ESP
                if data.Highlight then data.Highlight.Enabled = false end
                if data.Box then data.Box.Enabled = false end
                if data.Label then data.Label.Enabled = false end
                if data.Tracer then data.Tracer.Visible = false end
            end
        end
    end
end

-- Camera lock functions
LockButton.MouseButton1Click:Connect(function()
    if CAMERA_LOCK then
        -- Turn off
        CAMERA_LOCK = false
        LOCKED_PLAYER = nil
        LOCKED_CHARACTER = nil
        LockButton.Text = "ðŸ”’ OFF"
        LockButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    else
        -- Find closest visible enemy
        local closestPlayer = nil
        local closestDist = LOCK_RANGE + 1
        
        for _, player in pairs(Players:GetPlayers()) do
            if isEnemy(player) and player.Character then
                local char = player.Character
                local humanoid = char:FindFirstChild("Humanoid")
                local rootPart = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Head")
                
                if humanoid and humanoid.Health > 0 and rootPart then
                    local dist = (rootPart.Position - Camera.CFrame.Position).Magnitude
                    
                    if dist < closestDist and dist <= LOCK_RANGE then
                        if isVisible(rootPart.Position, char) then
                            closestDist = dist
                            closestPlayer = player
                        end
                    end
                end
            end
        end
        
        if closestPlayer then
            CAMERA_LOCK = true
            LOCKED_PLAYER = closestPlayer
            LOCKED_CHARACTER = closestPlayer.Character
            LockButton.Text = "ðŸ”“ LOCKED"
            LockButton.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        else
            LockButton.Text = "âŒ NO TARGET"
            LockButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
            
            task.wait(1)
            if not CAMERA_LOCK then
                LockButton.Text = "ðŸ”’ OFF"
                LockButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            end
        end
    end
end)

-- Camera lock update
function updateCameraLock()
    if CAMERA_LOCK and LOCKED_PLAYER and LOCKED_CHARACTER and isEnemy(LOCKED_PLAYER) then
        local char = LOCKED_CHARACTER
        local humanoid = char:FindFirstChild("Humanoid")
        local torso = char:FindFirstChild("HumanoidRootPart") or 
                      char:FindFirstChild("UpperTorso") or 
                      char:FindFirstChild("Torso")
        
        if humanoid and humanoid.Health > 0 and torso then
            -- Get camera's current position and look at the target's torso
            local camPos = Camera.CFrame.Position
            local targetPos = torso.Position + Vector3.new(0, 1.5, 0)
            
            -- Create a CFrame that looks from camera position to target
            local lookCFrame = CFrame.new(camPos, targetPos)
            
            -- Apply smooth camera movement
            Camera.CFrame = Camera.CFrame:Lerp(lookCFrame, SMOOTHNESS)
        else
            -- Target died or invalid
            CAMERA_LOCK = false
            LOCKED_PLAYER = nil
            LOCKED_CHARACTER = nil
            LockButton.Text = "ðŸ”’ OFF"
            LockButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
    end
end

-- Initialize ESP for all players
function initializeESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            createESP(player)
        end
    end
end

-- Event connections
Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then
        createESP(player)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    removeESP(player)
    if player == LOCKED_PLAYER then
        CAMERA_LOCK = false
        LOCKED_PLAYER = nil
        LOCKED_CHARACTER = nil
        LockButton.Text = "ðŸ”’ OFF"
        LockButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end
end)

-- Team change handling
LocalPlayer:GetPropertyChangedSignal("Team"):Connect(function()
    -- Reinitialize ESP when local player changes team
    for player, _ in pairs(ESPData) do
        removeESP(player)
    end
    task.wait(0.5)
    initializeESP()
end)

-- Main loop
local lastUpdate = 0
RunService.RenderStepped:Connect(function(delta)
    lastUpdate = lastUpdate + delta
    
    if lastUpdate >= REFRESH_RATE then
        if ESP_ENABLED then
            updateESP()
        end
        
        updateCameraLock()
        lastUpdate = 0
    end
end)

-- Initialize everything
task.wait(1) -- Wait for game to load
initializeESP()

print("âœ… Executor ESP & Camlock loaded!")
print("ðŸ“Œ Features:")
print("   - ESP showing distance, HP, visibility")
print("   - Team recognition (enemies only by default)")
print("   - Avatar highlighting")
print("   - Camera lock with toggle button")
print("   - Button is movable")
print("   - ESP always on")
print("\nðŸ”§ Settings:")
print("   - SHOW_TEAMMATES = " .. tostring(SHOW_TEAMMATES))
print("   - MAX_DISTANCE = " .. MAX_DISTANCE)
print("   - LOCK_RANGE = " .. LOCK_RANGE)

-- Cleanup function for executors
local function cleanup()
    for player, _ in pairs(ESPData) do
        removeESP(player)
    end
    if ScreenGui then
        ScreenGui:Destroy()
    end
    print("ðŸ§¹ ESP cleaned up")
end

-- Return cleanup function for executors that support it
return cleanup
