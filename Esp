-- LocalScript

-- Settings for ESP
local ESPColor = Color3.fromRGB(255, 0, 0)  -- Red color for ESP box and name
local NameTextSize = 18  -- Text size for player names above their head
local StudsOffset = Vector3.new(0, 3, 0)  -- Offset to position the name above the character

-- Function to create an ESP for a player
local function createESP(player)
    -- Ensure we're not applying ESP to the local player (our own character)
    if player == game.Players.LocalPlayer then return end

    -- Check if the player has a character and if it has a HumanoidRootPart
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local character = player.Character
        local hrp = character.HumanoidRootPart

        -- Create a BillboardGui to show the playerâ€™s name above their head
        local billboard = Instance.new("BillboardGui")
        billboard.Parent = hrp
        billboard.Adornee = hrp
        billboard.Size = UDim2.new(0, 100, 0, 50)
        billboard.StudsOffset = StudsOffset  -- Offset to position the name above the character
        billboard.AlwaysOnTop = true  -- Ensure the name is always visible
        billboard.BackgroundTransparency = 1  -- No background
        billboard.ZIndexBehavior = Enum.ZIndexBehavior.Sibling  -- Ensure it's always rendered in front of other elements

        -- Create a TextLabel to display the player's name
        local textLabel = Instance.new("TextLabel")
        textLabel.Parent = billboard
        textLabel.Text = player.Name
        textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)  -- White color
        textLabel.BackgroundTransparency = 1
        textLabel.TextSize = NameTextSize
        textLabel.TextStrokeTransparency = 0.8
        textLabel.TextStrokeColor3 = ESPColor

        -- Create an optional additional effect, like a border or glow effect if needed
        -- You can customize the border using additional UI elements (like UIStroke)

        -- Clean up the ESP when the player leaves
        player.AncestryChanged:Connect(function(_, parent)
            if not parent then
                billboard:Destroy()
            end
        end)
    end
end

-- Create ESP for all players in the game except the local player
for _, player in pairs(game.Players:GetPlayers()) do
    if player ~= game.Players.LocalPlayer then
        createESP(player)
    end
end

-- Listen for new players and create ESP for them
game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        if player ~= game.Players.LocalPlayer then
            createESP(player)
        end
    end)
end)

-- Optionally, listen for when players leave
game.Players.PlayerRemoving:Connect(function(player)
    -- Cleanup if player leaves
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = player.Character.HumanoidRootPart
        for _, part in pairs(workspace:GetChildren()) do
            if part:IsA("Part") and part.Parent == hrp.Parent then
                part:Destroy()
            end
        end
    end
end)
