-- LocalScript

-- Settings for ESP
local ESPColor = Color3.fromRGB(255, 0, 0)  -- Red color for ESP box and name
local BoxSize = Vector3.new(2, 5, 2)  -- The size of the box around the character

-- Function to create an ESP for a player
local function createESP(player)
    -- Ensure we're not applying ESP to the local player (our own character)
    if player == game.Players.LocalPlayer then return end

    -- Check if the player has a character and if it has a HumanoidRootPart
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local character = player.Character
        local hrp = character.HumanoidRootPart

        -- Create a BillboardGui to show the playerâ€™s name above their head
        local billboard = Instance.new("BillboardGui")
        billboard.Parent = hrp
        billboard.Adornee = hrp
        billboard.Size = UDim2.new(0, 100, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 3, 0)  -- Offset to position the name above the character
        billboard.AlwaysOnTop = true  -- Ensure the name is always visible

        local textLabel = Instance.new("TextLabel")
        textLabel.Parent = billboard
        textLabel.Text = player.Name
        textLabel.TextColor3 = Color3.new(1, 1, 1)  -- White color
        textLabel.BackgroundTransparency = 1
        textLabel.TextSize = 18
        textLabel.TextStrokeTransparency = 0.8

        -- Create a part to form the outline box around the character (the box is invisible, just for positioning)
        local box = Instance.new("Part")
        box.Size = BoxSize
        box.CFrame = hrp.CFrame
        box.Anchored = true
        box.CanCollide = false
        box.Transparency = 1  -- Make it fully invisible, just for positioning
        box.Parent = game.Workspace
        box.Material = Enum.Material.SmoothPlastic
        box.CastShadow = false

        -- Update the box position every frame to follow the player
        local function updateBoxPosition()
            while player.Character and player.Character:FindFirstChild("HumanoidRootPart") do
                -- Make the ESP box follow the player
                box.CFrame = player.Character.HumanoidRootPart.CFrame
                wait(0.1)  -- Update every 0.1 seconds
            end
            -- Clean up the box when the player leaves
            box:Destroy()
        end

        -- Start updating the box position
        spawn(updateBoxPosition)

        -- Clean up ESP when player leaves
        player.AncestryChanged:Connect(function(_, parent)
            if not parent then
                box:Destroy()
                billboard:Destroy()
            end
        end)
    end
end

-- Create ESP for all players in the game except the local player
for _, player in pairs(game.Players:GetPlayers()) do
    if player ~= game.Players.LocalPlayer then
        createESP(player)
    end
end

-- Listen for new players and create ESP for them
game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        if player ~= game.Players.LocalPlayer then
            createESP(player)
        end
    end)
end)

-- Optionally, listen for when players leave
game.Players.PlayerRemoving:Connect(function(player)
    -- Cleanup if player leaves
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = player.Character.HumanoidRootPart
        for _, part in pairs(workspace:GetChildren()) do
            if part:IsA("Part") and part.Parent == hrp.Parent then
                part:Destroy()
            end
        end
    end
end)
